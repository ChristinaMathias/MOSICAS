{
    "collab_server" : "",
    "contents" : "######\n######\n# fibre vs\n\nMPLOTCYCLE <- read.csv2('DATA/DATAVERSE/ecofi_plotcycle.csv',header=T,sep =\";\")\nMVARCYCLE <- read.csv2('DATA/DATAVERSE/ecofi_varcycle.csv',header=T,sep=';')\n\nhead(MPLOTCYCLE)\nhead(MVARCYCLE)\n\nMATTOT <- merge(MPLOTCYCLE,MVARCYCLE,by='plotcyclecode',all=T)\n\nMPLOT <- read.csv2('DATA/DATAVERSE/ecofi_plot.csv',header=T,sep =\";\",dec='.')\nMATTOT <- merge(MATTOT,MPLOT,by='plotcode',all=T)\n\nMVARIETY <- read.csv2('DATA/DATAVERSE/ecofi_variety.csv',header=T,sep=';')\n\nMATTOT <- merge(MATTOT,MVARIETY,by='varcode',all=T)\n\nhead(MATTOT)\nMATTOT$variety\n\n# on retire les NA, pas de la canne\nID <- which(!is.na(MATTOT$variety))\nMATTOT <- MATTOT[ID,]\nID <- which(!is.na(MATTOT$varcyclecode))\nMATTOT <- MATTOT[ID,]\nlength(unique(MATTOT$varcyclecode))\nlength((MATTOT$varcyclecode))\n\n# on recherche pour chaque var cycle code la production\nMOBS <- read.csv2('DATA/DATAVERSE/ecofi_obsplant.csv',header=T,sep=';',dec='.')\n\nIDOBS <- c('mfa','msa','mftu','mstu')            \nIDDATOBS <- c('Datemfa','Datemsa','Datemftu','Datemstu')            \n\nLISTOBS <- list(MFA <-c(), MSA <-c(), MFTU <- c(), MSTU <-c())\nLISTDAT <- list(MFA <-c(), MSA <-c(), MFTU <- c(), MSTU <-c())\nnames(LISTOBS) <- IDOBS\nnames(LISTDAT) <- IDDATOBS\n\nfor (i in 1:length(MATTOT$varcyclecode)){\n  \n  VCC <- as.vector(MATTOT$varcyclecode[i])\n  MTEMP <- MOBS[which(MOBS$varcyclecode==VCC),]\n  \n  for (j in 1:length(IDOBS)){\n    \n    IOBS <- IDOBS[j]\n    if(IOBS %in% as.vector(MTEMP$obsplantlib)){\n      MTEMP2 <- MTEMP[which(MTEMP$obsplantlib==IOBS),]\n      LISTOBS[[j]] <- c(LISTOBS[[j]], MTEMP2$obsplantval[dim(MTEMP2)[1]])\n      LISTDAT[[j]] <- c(LISTDAT[[j]], as.vector(MTEMP2$obsplantdate[dim(MTEMP2)[1]]))}\n    if((IOBS %in% as.vector(MTEMP$obsplantlib))==F) {\n      LISTOBS[[j]] <- c(LISTOBS[[j]],NA)\n      LISTDAT[[j]] <- c(LISTDAT[[j]],NA)}\n    \n  }\n}\n\n\nMATTOT$mfa <- LISTOBS$mfa               \nMATTOT$msa <- LISTOBS$msa               \nMATTOT$mftu <- LISTOBS$mftu               \nMATTOT$mstu <- LISTOBS$mstu               \nMATTOT$Datemfa <- LISTDAT$Datemfa               \nMATTOT$Datemsa <- LISTDAT$Datemsa               \nMATTOT$Datemftu <- LISTDAT$Datemftu               \nMATTOT$Datemstu <- LISTDAT$Datemstu               \n\n\nhead(MATTOT)\n\nboxplot(mfa~cropcode,data=MATTOT)\n\n\nlibrary(stringr)\n\nINIDAT <- (as.vector(MATTOT$cyclestartingdate))\nENDDAT <- (as.vector(MATTOT$cyclendingdate))\n\nDatMFA <- as.vector(MATTOT$Datemfa); DatMFA[which(is.na(DatMFA))] <- ENDDAT[which(is.na(DatMFA))]\nDatMSA <- as.vector(MATTOT$Datemsa); DatMSA[which(is.na(DatMSA))] <- ENDDAT[which(is.na(DatMSA))]\nDatMFTU <- as.vector(MATTOT$Datemftu); DatMFTU[which(is.na(DatMFTU))] <- ENDDAT[which(is.na(DatMFTU))]\nDatMSTU <- as.vector(MATTOT$Datemstu); DatMSTU[which(is.na(DatMSTU))] <- ENDDAT[which(is.na(DatMSTU))]\n\nNDMFA <- as.numeric(as.Date(DatMFA,format='%d/%m/%Y') -  as.Date(INIDAT,format='%d/%m/%Y'))\nNDMSA <- as.numeric(as.Date(DatMSA,format='%d/%m/%Y') -  as.Date(INIDAT,format='%d/%m/%Y'))\nNDMFTU <- as.numeric(as.Date(DatMFTU,format='%d/%m/%Y') -  as.Date(INIDAT,format='%d/%m/%Y'))\nNDMSTU <- as.numeric(as.Date(DatMSTU,format='%d/%m/%Y') -  as.Date(INIDAT,format='%d/%m/%Y'))\n\nplot(NDMFA,MATTOT$msa,xlim=c(0,550))\npoints(NDMFA[MATTOT$cropcode=='Mixtcane'],MATTOT$msa[MATTOT$cropcode=='Mixtcane'],pch=16,col=2)\n\nboxplot(MATTOT$msa/NDMSA ~MATTOT$cycle)\n\nid <- which(MATTOT$cropcode=='Mixtcane')\nboxplot(MATTOT$msa[id]/NDMSA[id] ~MATTOT$cycle[id])\n\nhead(MATTOT)\n\n\nMTEMP <- MATTOT[,c(4,6,7,10,13,14,16,17,23)] ; MTEMP$DATE <- NDMSA\nhead(MTEMP)\nid <- which(!is.na(MTEMP$msa))\nMTEMP <- MTEMP[id,]\n\ndim(MTEMP)\n\nrequire(FactoMineR)\nACP <- PCA(MTEMP,quali.sup=c(2,3,6,7))\n\nfit <- lm(msa~(cycle+nbbgi+rowspace+cropcode+variety+DATE)^2,data=MTEMP)\nanova(fit)\n\nY <-MTEMP$msa/MTEMP$DATE\nfit <- lm(Y~(cycle+nbbgi+rowspace+cropcode+variety)^2,data=MTEMP)\n\n\nX <- as.factor(as.vector(MTEMP$variety))\nbeanplot(MTEMP$msa/NDMSA[id] ~MTEMP$cropcode * X)\nbeanplot(MTEMP$msa/NDMSA[id] ~X,las=2)\n\nCROPVAR <- levels(X)\nCROPTYPE <-c()\nfor (i in 1:length(CROPVAR)){\n  CROPTYPE <- c(CROPTYPE, MATTOT$cropcode[which(MATTOT$variety==CROPVAR[i])[1]])\n}\nORDRE <- c(which(CROPTYPE==2),which(CROPTYPE==1))\nX <- factor(X,levels(X)[ORDRE])\n\n\n########################### figure\n# nombre d'essai par variétés\nLEN <- c()\nfor (i in 1:length(levels(X))){\n  MM <- MTEMP[which(MTEMP$variety==levels(X)[i]),]  \n  LEN <- c(LEN, length(unique(MM$varcyclecode)))\n}\n\nx11()\npar(mar=c(6,5,2,2),xaxs='r',yaxs='i')\nbeanplot(MTEMP$msa/NDMSA[id] ~X,las=2,axes=F,ylim=c(0,0.45),col='gray')\nmtext(text = expression('Relative growth rate in aerial dry matter'~~~(T~ha^-1~d^-1)),side = 2,line = 2.7,cex=1.3)\naxis(side = 2,at=(0:6)*0.05,labels = (0:6)*0.05,tck=0.02,padj=0.5)\naxis(side = 1,at=1:length(ORDRE),labels = levels(X),tck=0.02,las=2)\nabline(v=32.5)\ntext(x=1.5,y=0.43,labels = \"Sugarcane\",cex=1.2)\ntext(x=36,y=0.43,labels = \"Energy cane\",cex=1.2)\ntext(x=1:length(LEN),y=0.35,labels = LEN,cex=0.8)\ntext(x=0.2,y=0.38,labels='Number of plot cycle',pos=4,cex=0.8)\nbox()\n\nFACT \n\n\n\nplot(ACP,axes=c(1,2),habillage=6,label=NULL)\n\n\nplot(NDMFTU[ID],MATTOT$mstu[ID]/MATTOT$mftu[ID],xlim=c(0,550),ylim=c(0,1))\n\n\n\n\n1-mean((MATTOT$mstu/MATTOT$mftu)[which((MATTOT$variety=='R570')& (MATTOT$mstu/MATTOT$mftu<1))],na.rm=T)\n1-mean((MATTOT$msa/MATTOT$mfa)[which((MATTOT$variety=='R570')& (MATTOT$msa/MATTOT$mfa<1))],na.rm=T)\n\nplot(1-(MATTOT$mstu/MATTOT$mftu)[which((MATTOT$variety=='R570')& (MATTOT$mstu/MATTOT$mftu<1))])\nplot(NDMFA[which((MATTOT$variety=='R570')& (MATTOT$msa/MATTOT$mfa<1))],1-(MATTOT$msa/MATTOT$mfa)[which((MATTOT$variety=='R570')& (MATTOT$msa/MATTOT$mfa<1))])\n\nRATEMFA <- as.numeric(as.Date(DatMFA,format='%Y-%m-%d') -  as.Date(INIDAT,format='%Y-%m-%d'))\nRATEMSA <- as.numeric(as.Date(DatMSA,format='%Y-%m-%d') -  as.Date(INIDAT,format='%Y-%m-%d'))\nRATEMFTU <- as.numeric(as.Date(DatMFTU,format='%Y-%m-%d') -  as.Date(INIDAT,format='%Y-%m-%d'))\nRATEMSTU <- as.numeric(as.Date(DatMSTU,format='%Y-%m-%d') -  as.Date(INIDAT,format='%Y-%m-%d'))\nRATEMSUC <- as.numeric(as.Date(DatMSUC,format='%Y-%m-%d') -  as.Date(INIDAT,format='%Y-%m-%d'))\n\n\nboxplot(mfa/RATEMFA~cycle,data=MATTOT)\n\nboxplot(mftu/RATEMFTU~cycle,data=MATTOT)\n\nRMFA <- MATTOT$mfa / RATEMFA\nRMSA <- MATTOT$msa / RATEMSA\nRMFTU <- MATTOT$mftu / RATEMFTU\nRMSTU <- MATTOT$mstu / RATEMSTU\nRMSUC <- MATTOT$mssucrtu / RATEMSUC\n\nfit1 <- lm(RMFA~cycle * variety * rowspace * nbbgi,data=MATTOT)\nfit2 <- lm(RMSA~cycle * variety * rowspace * nbbgi,data=MATTOT)\nfit3 <- lm(RMFTU~cycle * variety * rowspace * nbbgi,data=MATTOT)\nfit4 <- lm(RMSTU~cycle * variety * rowspace * nbbgi,data=MATTOT)\nfit5 <- lm(RMSUC~cycle * variety * rowspace * nbbgi,data=MATTOT)\n\nfit1 <- lm(RMFA~cycle  * rowspace * nbbgi,data=MATTOT,subset=which(MATTOT$variety=='R570'))\nfit2 <- lm(RMSA~cycle  * rowspace * nbbgi,data=MATTOT,subset=which(MATTOT$variety=='R570'))\nfit3 <- lm(RMFTU~cycle  * rowspace * nbbgi,data=MATTOT,subset=which(MATTOT$variety=='R570'))\nfit4 <- lm(RMSTU~cycle  * rowspace * nbbgi,data=MATTOT,subset=which(MATTOT$variety=='R570'))\nfit5 <- lm(RMSUC~cycle  * rowspace * nbbgi,data=MATTOT,subset=which(MATTOT$variety=='R570'))\n\nfit4 <- lm(RMSTU~trialcode+variety+cycle  + rowspace + nbbgi,data=MATTOT)\nanova(fit4)\n\nrequire(beanplot)\n\nbeanplot(RMSTU~cycle,data=MATTOT,subset=which((MATTOT$variety=='R570')&(MATTOT$nbbgi==9)))\n\nbeanplot(RMSTU~cycle,data=MATTOT,subset=which((MATTOT$variety %in% c('R570','CP70321'))&(MATTOT$nbbgi==9)))\n\nbeanplot(RMSTU~cycle,data=MATTOT,subset=which((MATTOT$nbbgi==9)))\n\nID <- as.vector(unique(MATTOT$trialcode[which(MATTOT$cycle==3)]))\n\nboxplot(RMSTU~cycle,data=MATTOT,subset=which(MATTOT$trialcode %in% ID))\n\nplot(MATTOT$cycle,RMSTU)\nhead(MATTOT)\n\nCYCLE <- replace(MATTOT$cycle,MATTOT$cycle>0,1)\n\nbeanplot(RMSTU~CYCLE)\n\nnames(MATTOT)\n\n\nrequire(FactoMineR)\n\nnames(MATTOT)\n\nIRRI <- MATTOT$irricode ; IRRI <- replace(as.vector(IRRI),which(IRRI != 'PLUVIAL'),'IRRIG')\n\nMb <- data.frame(RMFA,RMSA,RMFTU,RMSTU,RMSUC,MATTOT[c(4,15,16,22)], IRRI)\n\nlibrary(missMDA)\n\nacp<- PCA(Mb)\n\n\n\n",
    "created" : 1556013105272.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3307932932",
    "id" : "2A1BFF16",
    "lastKnownWriteTime" : 1559627451,
    "last_content_update" : 1559627451520,
    "path" : "~/Recherche/Cirad/SD_Ecofy_base_donnees/R_base_donne/SCRIPT/R_Fig_datapapert.R",
    "project_path" : "SCRIPT/R_Fig_datapapert.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}