{
    "collab_server" : "",
    "contents" : "INPUTUSMS <- function(TREATCODE,SETOUT='DATA/STICS_MAILING_INPUT/',IDCODE=''){\n  \n TREATCODE <- sort(as.vector(TREATCODE))\n \n\n MATSOIL <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_genesoil.csv',header = T,sep =\";\",stringsAsFactors = F)\n MATPC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_plotcycle.csv',header = T,sep =\";\",stringsAsFactors = F)\n MATVC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_varcycle.csv',header = T,sep =\";\",stringsAsFactors = F)\n MATP <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_plot.csv',header = T,sep =\";\",stringsAsFactors = F)\n MATT <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_trial.csv',header = T,sep =\";\",stringsAsFactors = F)\n \n MATTOT <- merge(MATPC,MATVC, by='plotcyclecode',all=T)\n MATTOT <- merge(MATP,MATTOT, by='plotcode',all=T)\n MATTOT <- merge(MATT,MATTOT, by='trialcode',all=T)\n MATTOT <- MATTOT[which(MATTOT$varcyclecode %in% TREATCODE),]\n head(MATTOT)\n \n MATWT <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_wstrial.csv',header = T,sep =\";\")\n MATTOT <- merge(MATTOT,MATWT, by='trialcode',all.x=T,all.y=F)\n head(MATWT)\n # on prend un nouveau TREATCODE ordonné comme dans la data.frame\n TREATCODE <- as.vector(MATTOT$varcyclecode)\n \n usm_nom <- sapply(1:length(TREATCODE), function(i) paste('USM',TREATCODE[i],sep='_'))\n finit <- sapply(1:length(TREATCODE), function(i) paste(usm_nom[i],'_ini.xml',sep=''))\n nomsol <- sapply(1:length(TREATCODE), function(i) MATTOT$soilcode[which(MATTOT$varcyclecode==TREATCODE[i])])\n \n fstat <- sapply(1:length(TREATCODE), function(i) MATTOT$wscode[which(MATTOT$varcyclecode==TREATCODE[i])])\n fstation <- sapply(1:length(TREATCODE), function(i) paste(fstat[i],'WS_sta.xml',sep=''))\n\n \n \n# DateIni <- sapply(1:length(TREATCODE), function(i) substr(MATTOT$cyclestartingdate[i],1,10))\n# DateEnd <- sapply(1:length(TREATCODE), function(i) substr(MATTOT$cyclendingdate[i],1,10))\n YearIni <- as.numeric(sapply(1:length(TREATCODE), function(i) substr(MATTOT$cyclestartingdate[i],7,10)))\n YearEnd <- as.numeric(sapply(1:length(TREATCODE), function(i) substr(MATTOT$cyclendingdate[i],7,10)))\n DateIni <- as.Date(MATTOT$cyclestartingdate,format='%d/%m/%Y')\n DateEnd <- as.Date(MATTOT$cyclendingdate,format='%d/%m/%Y')\n DateRef <- sapply(1:length(TREATCODE), function(i) paste(YearIni[i],'-01-01',sep=''))\n DateRef <- as.Date(DateRef,format='%Y-%m-%d')\n datedebut <- as.numeric(DateIni-DateRef)+1\n datefin <- as.numeric(DateEnd-DateRef)+1\n ID <- which(datefin>730)\n datedebut[ID] <- 1#datedebut[ID]\n datefin[ID] <- datefin[ID]-365\n\n YearIni <- as.numeric(sapply(1:length(TREATCODE), function(i) substr(MATTOT$cyclestartingdate[i],7,10)))\n YearEnd <- as.numeric(sapply(1:length(TREATCODE), function(i) substr(MATTOT$cyclendingdate[i],7,10)))\n YearIni[ID] <- YearIni[ID]+1\n YearEnd[ID] <- YearEnd[ID]\n fclim1 <- sapply(1:length(TREATCODE), function(i) paste(fstat[i],'WS.',YearIni[i],sep=''))\n fclim2 <- sapply(1:length(TREATCODE), function(i) paste(fstat[i],'WS.',YearEnd[i],sep=''))\n \n data.frame(DateIni[ID] , DateEnd[ID], usm_nom[ID])\n\n culturean <- rep(2,length(TREATCODE)) ; ID <- which(YearIni==YearEnd) ;culturean[ID] <- 1 \n nbplantes <- rep(1,length(TREATCODE))\n codesimul <- rep(0,length(TREATCODE))\n fplt_1 <- rep('Sugarcane_CM2_plt.xml',length(TREATCODE))\n ftec_1 <- sapply(1:length(TREATCODE), function(i) paste('USM_',TREATCODE[i],'_tec.xml',sep=''))\n flai_1 <- rep('NULL',length(TREATCODE))\n fplt_2 <- rep('NULL',length(TREATCODE))\n ftec_2 <- rep('NULL',length(TREATCODE))\n flai_2 <- rep('NULL',length(TREATCODE))\n \n MATOUT <- data.frame(usm_nom=usm_nom,datedebut=datedebut,datefin=datefin,\n                      finit=finit,nomsol=nomsol,fstation=fstation,fclim1=fclim1,\n                      fclim2=fclim2,culturean=culturean,nbplantes=nbplantes,\n                      codesimul=codesimul,fplt_1=fplt_1,ftec_1=ftec_1,\n                      flai_1=flai_1,fplt_2=fplt_2,ftec_2=ftec_2,flai_2=flai_2)\n write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n            col.names = T,dec = '.',sep = ';')\n print(paste(dim(MATOUT)[1],' USMs created'))\n #\n\n}\n  \nINPUTINI <- function(IDCODE){\n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';')\n  LEN <- dim(MATUSMS)[1]\n  \n  Ini_name <- MATUSMS$finit\n  nbplantes <- rep(1,LEN)\n  stade0_Crop1 <- rep('plt',LEN)\n  lai0_Crop1 <- rep(0,LEN)\n  masec0_Crop1\t <- rep(0,LEN)\n  QNplante0_Crop1\t <- rep(0,LEN)\n  magrain0_Crop1\t <- rep(0,LEN)\n  zrac0_Crop1\t <- rep(0,LEN)\n  resperenne0_Crop1 <- rep(0,LEN)\n  densinitial_1_Crop1\t <- rep(0,LEN)\n  densinitial_2_Crop1\t <- rep(0,LEN)\n  densinitial_3_Crop1\t <- rep(0,LEN)\n  densinitial_4_Crop1\t <- rep(0,LEN)\n  densinitial_5_Crop1\t <- rep(0,LEN)\n  stade0_Crop2\t <- rep(0,LEN)\n  lai0_Crop2\t <- rep(0,LEN)\n  masec0_Crop2\t <- rep(0,LEN)\n  QNplante0_Crop2\t <- rep(0,LEN)\n  magrain0_Crop2\t <- rep(0,LEN)\n  zrac0_Crop2\t <- rep(0,LEN)\n  resperenne0_Crop2\t <- rep(0,LEN)\n  densinitial_1_Crop2\t <- rep(0,LEN)\n  densinitial_2_Crop2\t <- rep(0,LEN)\n  densinitial_3_Crop2\t <- rep(0,LEN)\n  densinitial_4_Crop2\t <- rep(0,LEN)\n  densinitial_5_Crop2\t <- rep(0,LEN)\n  hinit_1\t <- rep(0,LEN)\n  hinit_2\t <- rep(0,LEN)\n  hinit_3\t <- rep(0,LEN)\n  hinit_4\t <- rep(0,LEN)\n  hinit_5\t <- rep(0,LEN)\n  NO3init_1\t <- rep(32,LEN)\n  NO3init_2\t <- rep(12,LEN)\n  NO3init_3\t <- rep(9,LEN)\n  NO3init_4\t <- rep(9,LEN)\n  NO3init_5\t <- rep(9,LEN)\n  NH4init_1\t <- rep(0,LEN)\n  NH4init_2\t <- rep(0,LEN)\n  NH4init_3\t <- rep(0,LEN)\n  NH4init_4\t <- rep(0,LEN)\n  NH4init_5 <- rep(0,LEN)\n  \n  MATOUT <- data.frame(Ini_name,nbplantes,stade0_Crop1,lai0_Crop1,masec0_Crop1,QNplante0_Crop1,\n                       magrain0_Crop1,zrac0_Crop1,resperenne0_Crop1,densinitial_1_Crop1,\n                       densinitial_2_Crop1,densinitial_3_Crop1,densinitial_4_Crop1,densinitial_5_Crop1,\n                       stade0_Crop2,lai0_Crop2,masec0_Crop2,QNplante0_Crop2,magrain0_Crop2,zrac0_Crop2,\n                       resperenne0_Crop2,densinitial_1_Crop2,densinitial_2_Crop2,densinitial_3_Crop2,\n                       densinitial_4_Crop2,densinitial_5_Crop2,hinit_1,hinit_2,hinit_3,hinit_4,hinit_5,\n                       NO3init_1,NO3init_2,NO3init_3,NO3init_4,NO3init_5,\n                       NH4init_1,NH4init_2,NH4init_3,NH4init_4,NH4init_5)  \n  \n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/INI_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Initial conditions created'))\n  \n}\n\nINPUTSOIL <- function(IDCODE){\n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';')\n\n  TREATSOIL <- MATUSMS$nomsol  \n  \n  MATSOIL <- read.csv2(file = 'DATA/ECOFI_DATAVERSE//ecofi_genesoil.csv',header = T,sep =\";\",stringsAsFactors=F)\n  MATLAYSOIL <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_layersoil.csv',header = T,dec='.',sep =\";\",stringsAsFactors=F)\n\n  MATSOIL <- MATSOIL[which(MATSOIL$soilcode %in% TREATSOIL),]\n  LEN <- dim(MATSOIL)[1]\n    \n  Soil_name <- as.vector(MATSOIL$soilcode)\n  \n  epc_1 <- c() ;epc_2 <- c() ;epc_3 <- c() ;epc_4 <- c() ;epc_5 <- c()  \n  HCCF_1 <- c() ;HCCF_2 <- c() ;HCCF_3 <- c() ;HCCF_4 <- c() ;HCCF_5 <- c()  \n  HMINF_1 <- c() ;HMINF_2 <- c() ;HMINF_3 <- c() ;HMINF_4 <- c() ;HMINF_5 <- c()  \n  DAF_1 <- c() ;DAF_2 <- c() ;DAF_3 <- c() ;DAF_4 <- c() ;DAF_5 <- c()  \n  \n  for (i in 1:length(Soil_name)){\n    MATTEMP <- MATLAYSOIL[which(MATLAYSOIL$soilcode==Soil_name[i]),]\n    NBLAY <- dim(MATTEMP)[1]/5\n    \n    if (NBLAY %in% c(0,1)){\n      IDSOIL <- Soil_name[i]\n      MATSOIL[which(MATSOIL$soilcode==Soil_name[i]),]\n      epc <- rep(round(MATSOIL[which(MATSOIL$soilcode==Soil_name[i]),]$depthsoil/5,0),5)\n      HCCF <- rep((300+MATSOIL[which(MATSOIL$soilcode==Soil_name[i]),]$ru)/10,5)\n      HMINF <- rep(30,5)\n      DAF <- rep(1,5)\n    }\n    if (NBLAY > 1) {\n      epc <- c(); HCCF <-c();HMINF <-c();DAF <-c()\n      for (j in 1:min(5,NBLAY)){\n        epc <- c(epc,MATTEMP$layerval[MATTEMP$layerlib=='epaiss'][MATTEMP$layernum[MATTEMP$layerlib=='epaiss']==j]*1)\n        HCCF <- c(HCCF,MATTEMP$layerval[MATTEMP$layerlib=='hcc'][MATTEMP$layernum[MATTEMP$layerlib=='hcc']==j]*100)\n        HMINF <- c(HMINF,MATTEMP$layerval[MATTEMP$layerlib=='hpf'][MATTEMP$layernum[MATTEMP$layerlib=='hpf']==j]*100)\n        DAF <- c(DAF,MATTEMP$layerval[MATTEMP$layerlib=='bdens'][MATTEMP$layernum[MATTEMP$layerlib=='bdens']==j]*1)\n      }\n      if(NBLAY <5){\n        epc <- c(epc, rep(epc[NBLAY],5-NBLAY))\n        HCCF <- c(HCCF, rep(HCCF[NBLAY],5-NBLAY))\n        HMINF <- c(HMINF, rep(HMINF[NBLAY],5-NBLAY))\n        DAF <- c(DAF, rep(DAF[NBLAY],5-NBLAY))\n      }\n    }\n    \n    epc_1 <- c(epc_1,epc[1]) ;epc_2 <- c(epc_2,epc[2]) ;epc_3 <- c(epc_3,epc[3]) ;epc_4 <- c(epc_4,epc[4]) ;epc_5 <- c(epc_5,epc[5])\n    HCCF_1 <- c(HCCF_1,HCCF[1]) ;HCCF_2 <- c(HCCF_2,HCCF[2]) ;HCCF_3 <- c(HCCF_3,HCCF[3]) ;HCCF_4 <- c(HCCF_4,HCCF[4]) ;HCCF_5 <- c(HCCF_5,HCCF[5])\n    HMINF_1 <- c(HMINF_1,HMINF[1]) ;HMINF_2 <- c(HMINF_2,HMINF[2]) ;HMINF_3 <- c(HMINF_3,HMINF[3]) ;HMINF_4 <- c(HMINF_4,HMINF[4]) ;HMINF_5 <- c(HMINF_5,HMINF[5])\n    DAF_1 <- c(DAF_1,DAF[1]) ;DAF_2 <- c(DAF_2,DAF[2]) ;DAF_3 <- c(DAF_3,DAF[3]) ;DAF_4 <- c(DAF_4,DAF[4]) ;DAF_5 <- c(DAF_5,DAF[5])\n  }\n  \n  epc_5 <- epc_5+40\n  argi <- rep(17,LEN)\n  norg <- rep(0.12,LEN)\n  profhum <- rep(35,LEN)\n  calc <- rep(1,LEN)\n  pH <- rep(6,LEN)\n  concseuil <- rep(0,LEN)\n  albedo <- rep(0.2,LEN)\n  q0 <- rep(0,LEN)\n  ruisolnu <- rep(0,LEN)\n  obstarac <- MATSOIL$rootdepth +40\n  pluiebat <- rep(50,LEN)\n  mulchbat <- rep(0.5,LEN)\n  zesx <- rep(60,LEN)\n  cfes <- rep(5,LEN)\n  z0solnu <- rep(0.01,LEN)\n  CsurNsol <- rep(13,LEN)\n  penterui <- rep(0.33,LEN)\n  codecailloux <- rep(2,LEN)\n  codemacropor <- rep(2,LEN)\n  codefente <- rep(2,LEN)\n  codrainage <- rep(2,LEN)\n  profimper <- rep(0,LEN)\n  ecartdrain <- rep(0,LEN)\n  ksol <- rep(0,LEN)\n  profdrain <- rep(0,LEN)\n  coderemontcap <- rep(2,LEN)\n  capiljour <- rep(0,LEN)\n  humcapil <- rep(0,LEN)\n  codenitrif <- rep(2,LEN)\n  codedenit <- rep(2,LEN)\n  profdenit <- rep(20,LEN)\n  vpotdenit <- rep(2.6,LEN)\n  cailloux_1 <- rep(0,LEN)\n  typecailloux_1 <- rep(1,LEN)\n  infil_1 <- rep(50,LEN)\n  epd_1 <- rep(10,LEN)\n  cailloux_2 <- rep(0,LEN)\n  typecailloux_2 <- rep(1,LEN)\n  infil_2 <- rep(50,LEN)\n  epd_2 <- rep(10,LEN)\n  cailloux_3 <- rep(0,LEN)\n  typecailloux_3 <- rep(1,LEN)\n  infil_3 <- rep(50,LEN)\n  epd_3 <- rep(10,LEN)\n  cailloux_4 <- rep(0,LEN)\n  typecailloux_4 <- rep(1,LEN)\n  infil_4 <- rep(0,LEN)\n  epd_4 <- rep(0,LEN)\n  cailloux_5 <- rep(0,LEN)\n  typecailloux_5 <- rep(1,LEN)\n  infil_5 <- rep(0,LEN)\n  epd_5 <- rep(0,LEN)\n  \n  MATOUT <- data.frame(Soil_name,argi,norg,profhum,calc,pH,concseuil,albedo,q0,ruisolnu,obstarac,\n                       pluiebat,mulchbat,zesx,cfes,z0solnu,CsurNsol,penterui,codecailloux,codemacropor,\n                       codefente,codrainage,profimper,ecartdrain,ksol,profdrain,coderemontcap,capiljour,\n                       humcapil,codenitrif,codedenit,profdenit,vpotdenit,epc_1,HCCF_1,HMINF_1,DAF_1,\n                       cailloux_1,typecailloux_1,infil_1,epd_1,epc_2,HCCF_2,HMINF_2,DAF_2,cailloux_2,\n                       typecailloux_2,infil_2,epd_2,epc_3,HCCF_3,HMINF_3,DAF_3,cailloux_3,\n                       typecailloux_3,infil_3,epd_3,epc_4,HCCF_4,HMINF_4,DAF_4,cailloux_4,\n                       typecailloux_4,infil_4,epd_4,epc_5,HCCF_5,HMINF_5,DAF_5,cailloux_5,\n                       typecailloux_5,infil_5,epd_5)\n  \n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/SOILS_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Soils created'))\n}\n\nINPUTTEC <- function(IDCODE){\n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';',stringsAsFactors = F)\n  require(stringr)\n  TREATCODE <- sapply(1:dim(MATUSMS)[1], function(i) str_sub(MATUSMS$usm_nom[i],start=5))\n  \n  TREATTEC <- MATUSMS$ftec_1  ; LEN <- length(TREATTEC)\n\n  MATINI <- read.csv2('DATA/STICS_MAILING_INPUT/Tec_ini.csv',header=T,sep=';')\n  MATINI[,1:10]\n  VALINI <- MATINI[which(MATINI$ITK_name=='USM_DEFAULT'),]\n  MATINIout <- VALINI ; for (i in 1:(length(TREATTEC)-1)){MATINIout <- rbind(MATINIout,VALINI)}\n\n  MATINIout$ITK_name <- TREATTEC\n  MATINIout$iplt0 <- MATUSMS$datedebut\n  MATINIout$profsem <- rep(10,LEN)\n  MATINIout$densitesem <- rep(8,LEN)\n  if(IDCODE=='ALL_R570'){  MATINIout$variete <- rep(3,LEN)}\n  #MATINIout$codetradtec <- rep(2,LEN)\n  MATINIout$irec <- MATUSMS$datefin\n  MATINIout$engrais <- rep(3,LEN)\n  MATINIout$julapN_or_sum_upvt_1 <- MATUSMS$datedebut\n  MATINIout$Amount_N_Ferti_1 <- rep(220,LEN)\n  MATINIout$codrecolte <- rep(1,LEN)\n  \n  \n  MATPC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_plotcycle.csv',header = T,sep =\";\")\n  MATVC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_varcycle.csv',header = T,sep =\";\")\n  MATMERGE <- merge(MATPC,MATVC,all.y=T) ; MATMERGE <- MATMERGE[which(MATMERGE$varcyclecode %in% TREATCODE),]\n  IRRCODE <- as.vector(sapply(1:length(TREATCODE), function(i) MATMERGE$irricode[which(MATMERGE$varcyclecode==TREATCODE[i])]))\n\n  MATIRRDATA <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_irridata.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATIRRDATA)\n  \n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE=='NC',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE=='NC',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE=='NC',25)\n\n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE !='RAINFED',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE !='RAINFED',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE !='RAINFED',5)\n  MATOUT <- MATINIout\n#  DIMIRR <- c()\n#  for (i in 1:length(IRRCODE)){\n#    if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n#      MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n#      DIMIRR <- c(DIMIRR,dim(MATTEMP)[1])\n#    }}\n#  MAXIRR <- max(DIMIRR)\n#  MATOUT <- MATINIout\n#  for (j in 21:(MAXIRR+10)){\n#    NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n#    NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n#    MATOUT <- cbind(MATOUT,rep(999,length(TREATTEC))); \n#    names(MATOUT)[294+(j-21)+(j-20)] <- NAME1\n#    MATOUT <- cbind(MATOUT,rep(0,length(TREATTEC))); \n#    names(MATOUT)[294+(j-19)+(j-21)] <- NAME2\n#  }\n\n#  for (i in 1:length(TREATTEC)){\n#    if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n#      MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n#      INIYEAR <- substr(MATTEMP$irridate[1],7,10) ; INIDAT <- as.Date(paste(INIYEAR,'-01-01',sep=\"\"),format=\"%Y-%m-%d\")\n#      IRRDAT <- MATTEMP$irridate ; IRRDAT <- as.Date(IRRDAT,format=\"%d/%m/%Y\")\n#      for (j in 1:dim(MATTEMP)[1]){\n#        NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n#        NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n#        MATOUT[,NAME1][i] <- as.numeric(IRRDAT[j]-INIDAT)+1\n#        MATOUT[,NAME2][i] <- MATTEMP$irridose[j]\n#      }\n#      }\n      \n#  }\n\n  \n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/TEC_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Tec created'))\n  \n  \n}\n\nINPUTTECV10 <- function(IDCODE){\n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';',stringsAsFactors = F)\n  require(stringr)\n  TREATCODE <- sapply(1:dim(MATUSMS)[1], function(i) str_sub(MATUSMS$usm_nom[i],start=5))\n  \n  TREATTEC <- MATUSMS$ftec_1  ; LEN <- length(TREATTEC)\n  \n  MATINI <- read.csv2('DATA/STICS_MAILING_INPUT/Tec_ini.csv',header=T,sep=';')\n  MATINI[,1:10]\n  VALINI <- MATINI[which(MATINI$ITK_name=='USM_DEFAULT'),]\n  MATINIout <- VALINI ; for (i in 1:(length(TREATTEC)-1)){MATINIout <- rbind(MATINIout,VALINI)}\n  \n  MATINIout$ITK_name <- TREATTEC\n  MATINIout$iplt0 <- MATUSMS$datedebut\n  MATINIout$profsem <- rep(10,LEN)\n  MATINIout$densitesem <- rep(8,LEN)\n  if(IDCODE=='ALL_R570'){  MATINIout$variete <- rep(3,LEN)}\n  #MATINIout$codetradtec <- rep(2,LEN)\n  MATINIout$codestade <- rep(2,LEN)\n  MATINIout$codetaille <- rep(2,LEN)\n  MATINIout$jultaille <- MATUSMS$datefin\n  MATINIout$irec <- rep(999,LEN)\n  MATINIout$engrais <- rep(3,LEN)\n  MATINIout$julapN_or_sum_upvt_1 <- MATUSMS$datedebut\n  MATINIout$Amount_N_Ferti_1 <- rep(220,LEN)\n  MATINIout$codrecolte <- rep(1,LEN)\n  \n  \n  MATPC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_plotcycle.csv',header = T,sep =\";\")\n  MATVC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_varcycle.csv',header = T,sep =\";\")\n  MATMERGE <- merge(MATPC,MATVC,all.y=T) ; MATMERGE <- MATMERGE[which(MATMERGE$varcyclecode %in% TREATCODE),]\n  IRRCODE <- as.vector(sapply(1:length(TREATCODE), function(i) MATMERGE$irricode[which(MATMERGE$varcyclecode==TREATCODE[i])]))\n  \n  MATIRRDATA <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_irridata.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATIRRDATA)\n  \n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE=='NC',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE=='NC',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE=='NC',25)\n  \n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE !='RAINFED',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE !='RAINFED',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE !='RAINFED',5)\n  MATOUT <- MATINIout\n  #  DIMIRR <- c()\n  #  for (i in 1:length(IRRCODE)){\n  #    if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n  #      MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n  #      DIMIRR <- c(DIMIRR,dim(MATTEMP)[1])\n  #    }}\n  #  MAXIRR <- max(DIMIRR)\n  #  MATOUT <- MATINIout\n  #  for (j in 21:(MAXIRR+10)){\n  #    NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n  #    NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n  #    MATOUT <- cbind(MATOUT,rep(999,length(TREATTEC))); \n  #    names(MATOUT)[294+(j-21)+(j-20)] <- NAME1\n  #    MATOUT <- cbind(MATOUT,rep(0,length(TREATTEC))); \n  #    names(MATOUT)[294+(j-19)+(j-21)] <- NAME2\n  #  }\n  \n  #  for (i in 1:length(TREATTEC)){\n  #    if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n  #      MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n  #      INIYEAR <- substr(MATTEMP$irridate[1],7,10) ; INIDAT <- as.Date(paste(INIYEAR,'-01-01',sep=\"\"),format=\"%Y-%m-%d\")\n  #      IRRDAT <- MATTEMP$irridate ; IRRDAT <- as.Date(IRRDAT,format=\"%d/%m/%Y\")\n  #      for (j in 1:dim(MATTEMP)[1]){\n  #        NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n  #        NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n  #        MATOUT[,NAME1][i] <- as.numeric(IRRDAT[j]-INIDAT)+1\n  #        MATOUT[,NAME2][i] <- MATTEMP$irridose[j]\n  #      }\n  #      }\n  \n  #  }\n  \n  \n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/TEC_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Tec created'))\n  \n  \n}\n\nINPUTTECIRRIG <- function(IDCODE){\n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';',stringsAsFactors = F)\n  require(stringr)\n  TREATCODE <- sapply(1:dim(MATUSMS)[1], function(i) str_sub(MATUSMS$usm_nom[i],start=5))\n  \n  TREATTEC <- MATUSMS$ftec_1  ; LEN <- length(TREATTEC)\n  \n  MATINI <- read.csv2('DATA/STICS_MAILING_INPUT/Tec_ini.csv',header=T,sep=';')\n  MATINI[,1:10]\n  VALINI <- MATINI[which(MATINI$ITK_name=='USM_DEFAULT'),]\n  MATINIout <- VALINI ; for (i in 1:(length(TREATTEC)-1)){MATINIout <- rbind(MATINIout,VALINI)}\n  \n  MATINIout$ITK_name <- TREATTEC\n  MATINIout$iplt0 <- MATUSMS$datedebut\n  MATINIout$profsem <- rep(10,LEN)\n  MATINIout$densitesem <- rep(8,LEN)\n  if(IDCODE=='ALL_R570'){  MATINIout$variete <- rep(3,LEN)}\n  #MATINIout$codetradtec <- rep(2,LEN)\n  MATINIout$irec <- MATUSMS$datefin\n  MATINIout$engrais <- rep(3,LEN)\n  MATINIout$julapN_or_sum_upvt_1 <- MATUSMS$datedebut\n  MATINIout$Amount_N_Ferti_1 <- rep(220,LEN)\n  MATINIout$codrecolte <- rep(1,LEN)\n  \n  \n  MATPC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_plotcycle.csv',header = T,sep =\";\")\n  MATVC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_varcycle.csv',header = T,sep =\";\")\n  MATMERGE <- merge(MATPC,MATVC,all.y=T) ; MATMERGE <- MATMERGE[which(MATMERGE$varcyclecode %in% TREATCODE),]\n  IRRCODE <- as.vector(sapply(1:length(TREATCODE), function(i) MATMERGE$irricode[which(MATMERGE$varcyclecode==TREATCODE[i])]))\n  \n  MATIRRDATA <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_irridata.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATIRRDATA)\n\n  # when NC means that there is irrgation but not indicated  \n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE=='NC',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE=='NC',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE=='NC',25)\n  \n  MATOUT <- MATINIout\n    DIMIRR <- c()\n    for (i in 1:length(IRRCODE)){\n      if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n        MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n        DIMIRR <- c(DIMIRR,dim(MATTEMP)[1])\n      }}\n    MAXIRR <- max(DIMIRR)\n    MATOUT <- MATINIout\n    for (j in 21:(MAXIRR+10)){\n      NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n      NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n      MATOUT <- cbind(MATOUT,rep(999,length(TREATTEC))); \n      names(MATOUT)[294+(j-21)+(j-20)] <- NAME1\n      MATOUT <- cbind(MATOUT,rep(0,length(TREATTEC))); \n      names(MATOUT)[294+(j-19)+(j-21)] <- NAME2\n    }\n  \n    for (i in 1:length(TREATTEC)){\n      if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n        MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n        INIYEAR <- substr(MATTEMP$irridate[1],7,10) ; INIDAT <- as.Date(paste(INIYEAR,'-01-01',sep=\"\"),format=\"%Y-%m-%d\")\n        IRRDAT <- MATTEMP$irridate ; IRRDAT <- as.Date(IRRDAT,format=\"%d/%m/%Y\")\n        for (j in 1:dim(MATTEMP)[1]){\n          NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n          NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n          MATOUT[,NAME1][i] <- as.numeric(IRRDAT[j]-INIDAT)+1\n          MATOUT[,NAME2][i] <- MATTEMP$irridose[j]\n        }\n        }\n  \n    }\n  \n  \n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/TEC_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Tec created'))\n  \n  \n}\n\nINPUTTECIRRIGV10 <- function(IDCODE){\n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';',stringsAsFactors = F)\n  require(stringr)\n  TREATCODE <- sapply(1:dim(MATUSMS)[1], function(i) str_sub(MATUSMS$usm_nom[i],start=5))\n  \n  TREATTEC <- MATUSMS$ftec_1  ; LEN <- length(TREATTEC)\n  \n  MATINI <- read.csv2('DATA/STICS_MAILING_INPUT/Tec_ini.csv',header=T,sep=';')\n  MATINI[,1:10]\n  VALINI <- MATINI[which(MATINI$ITK_name=='USM_DEFAULT'),]\n  MATINIout <- VALINI ; for (i in 1:(length(TREATTEC)-1)){MATINIout <- rbind(MATINIout,VALINI)}\n  \n  MATINIout$ITK_name <- TREATTEC\n  MATINIout$iplt0 <- MATUSMS$datedebut\n  MATINIout$profsem <- rep(10,LEN)\n  MATINIout$densitesem <- rep(8,LEN)\n  if(IDCODE=='ALL_R570'){  MATINIout$variete <- rep(3,LEN)}\n  #MATINIout$codetradtec <- rep(2,LEN)\n  MATINIout$codestade <- rep(2,LEN)\n  MATINIout$codetaille <- rep(2,LEN)\n  MATINIout$jultaille <- MATUSMS$datefin\n  MATINIout$irec <- rep(999,LEN)\n  MATINIout$engrais <- rep(3,LEN)\n  MATINIout$julapN_or_sum_upvt_1 <- MATUSMS$datedebut\n  MATINIout$Amount_N_Ferti_1 <- rep(220,LEN)\n  MATINIout$codrecolte <- rep(1,LEN)\n  \n  \n  MATPC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_plotcycle.csv',header = T,sep =\";\")\n  MATVC <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_varcycle.csv',header = T,sep =\";\")\n  MATMERGE <- merge(MATPC,MATVC,all.y=T) ; MATMERGE <- MATMERGE[which(MATMERGE$varcyclecode %in% TREATCODE),]\n  IRRCODE <- as.vector(sapply(1:length(TREATCODE), function(i) MATMERGE$irricode[which(MATMERGE$varcyclecode==TREATCODE[i])]))\n  \n  MATIRRDATA <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_irridata.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATIRRDATA)\n  \n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE=='NC',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE=='NC',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE=='NC',25)\n  \n  MATINIout[,'codecalirrig'] <- replace(MATINIout[,'codecalirrig'],IRRCODE !='RAINFED',1)\n  MATINIout[,'ratiol'] <- replace(MATINIout[,'ratiol'],IRRCODE !='RAINFED',0.9)\n  MATINIout[,'dosimx'] <- replace(MATINIout[,'dosimx'],IRRCODE !='RAINFED',5)\n  MATOUT <- MATINIout\n    DIMIRR <- c()\n    for (i in 1:length(IRRCODE)){\n      if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n        MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n        DIMIRR <- c(DIMIRR,dim(MATTEMP)[1])\n      }}\n    MAXIRR <- max(DIMIRR)\n    MATOUT <- MATINIout\n    for (j in 21:(MAXIRR+10)){\n      NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n      NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n      MATOUT <- cbind(MATOUT,rep(999,length(TREATTEC))); \n      names(MATOUT)[294+(j-21)+(j-20)] <- NAME1\n      MATOUT <- cbind(MATOUT,rep(0,length(TREATTEC))); \n      names(MATOUT)[294+(j-19)+(j-21)] <- NAME2\n    }\n  \n    for (i in 1:length(TREATTEC)){\n      if ((IRRCODE[i] != 'RAINFED')&(IRRCODE[i] != 'NC')){\n        MATTEMP <- MATIRRDATA[which(MATIRRDATA$irricode==IRRCODE[i]),]\n        INIYEAR <- substr(MATTEMP$irridate[1],7,10) ; INIDAT <- as.Date(paste(INIYEAR,'-01-01',sep=\"\"),format=\"%Y-%m-%d\")\n        IRRDAT <- MATTEMP$irridate ; IRRDAT <- as.Date(IRRDAT,format=\"%d/%m/%Y\")\n        for (j in 1:dim(MATTEMP)[1]){\n          NAME1 <- paste('julapI_or_sum_upvt_',j,sep=\"\")\n          NAME2 <- paste('Amount_Irrig_',j,sep=\"\")\n          MATOUT[,NAME1][i] <- as.numeric(IRRDAT[j]-INIDAT)+1\n          MATOUT[,NAME2][i] <- MATTEMP$irridose[j]\n        }\n        }\n  \n    }\n  \n  \n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/TEC_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Tec created'))\n  \n  \n}\n\nINPUTSTA <- function(IDCODE){\n  \n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';')\n  \n  MATWS <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_ws.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATWS)  \n\n  require(stringr)  \n  WSTACODE <- levels(MATUSMS$fstation)\n  LEN <- length(WSTACODE)\n  WSCODE <- str_sub(WSTACODE,end=-9)\n  \n  Sta_name <- WSTACODE\n  zr<- rep(3.5,LEN)\n  NH3ref <- rep(0,LEN)\n  latitude <- sapply(1:LEN, function(i) MATWS$wslat[MATWS$wscode==str_sub(WSCODE[i],end=-3)])\n  patm <- rep(1000,LEN)\n  aclim <- rep(20,LEN)\n  codeetp <- rep(1,LEN)\n  alphapt <- rep(1.26,LEN)\n  codeclichange <- rep(1,LEN)\n  codaltitude <- rep(1,LEN)\n  altistation <- sapply(1:LEN, function(i) MATWS$wsalt[MATWS$wscode==str_sub(WSCODE[i],end=-3)])\n  altisimul <- sapply(1:LEN, function(i) MATWS$wsalt[MATWS$wscode==str_sub(WSCODE[i],end=-3)])\n  gradtn <- rep(-0.5,LEN)\n  gradtx <- rep(-0.55,LEN)\n  altinversion<- rep(500,LEN)\n  gradtninv <- rep(1.3,LEN)\n  cielclair<- rep(0.8,LEN)\n  codadret <- rep(1,LEN)\n  ombragetx <- rep(-1.4,LEN)\n  ra <- rep(50,LEN)\n  albveg <- rep(0.23,LEN)\n  aangst <- rep(0.18,LEN)\n  bangst <- rep(0.62,LEN)\n  corecTrosee <- rep(1,LEN)\n  codecaltemp <- rep(2,LEN)\n  codernet <- rep(2,LEN)\n  coefdevil <- rep(0.7,LEN)\n  aks <- rep(6,LEN)\n  bks <- rep(0.5,LEN)\n  cvent <- rep(0.16,LEN)\n  phiv0 <- rep(0.004,LEN)\n  coefrnet <- rep(0.59,LEN)\n\n  MATOUT <- data.frame(Sta_name,zr,NH3ref,latitude,patm,aclim,codeetp,alphapt,codeclichange,\n                       codaltitude,altistation,altisimul,gradtn,gradtx,altinversion,gradtninv,\n                       cielclair,codadret,ombragetx,ra,albveg,aangst,bangst,corecTrosee,\n                       codecaltemp,codernet,coefdevil,aks,bks,cvent,phiv0,coefrnet)\n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/STATION_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Station created'))\n  \n}\n\nINPUTWEATHER <- function(IDCODE){\n  \n  MATSTA <- read.csv2(paste('DATA/STICS_MAILING_INPUT/STATION_',IDCODE,'.csv',sep=''),header=T,sep=';')\n\n  TREATSTA <- MATSTA$Sta_name  \n  require(stringr)\n  TREATSTA <- str_sub(TREATSTA,end=-11)\n\n  MATWDATA <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_wdataday.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATWDATA)  \n\n  MATTEMP <- MATWDATA[which(MATWDATA$wscode %in% TREATSTA),]  \n  head(MATTEMP)    \n\n  Weather_name <- sapply(1:dim(MATTEMP)[1],function(i) paste(MATTEMP$wscode[i],'WS',sep=''))\n  ian <- str_sub(MATTEMP$weatherdate,start=7)\n  mo <- as.numeric(str_sub(MATTEMP$weatherdate,start=4,end=5))\n  jo <- as.numeric(str_sub(MATTEMP$weatherdate,start=1,end=2))\n  YearIni <- ian ; DateIni <- sapply(1:length(ian), function(i) paste(YearIni[i],'-01-01',sep=''))\n  DateIni <- as.Date(DateIni, format='%Y-%m-%d')\n  DATE <- as.Date(MATTEMP$weatherdate,format='%d/%m/%Y')\n  jul <- sapply(1:length(ian), function(i) as.numeric(DATE[i]-DateIni[i])+1)\n  tmin <- as.numeric(MATTEMP$tmin) ; tmin <- replace(tmin, is.na(tmin),mean(tmin,na.rm=T))\n  tmax <- as.numeric(MATTEMP$tmax); tmax <- replace(tmax, is.na(tmax),mean(tmax,na.rm=T))\n  srad <- as.numeric(MATTEMP$grad); srad <- replace(srad, is.na(srad),mean(srad,na.rm=T))\n  ETP <- as.numeric(MATTEMP$eto); ETP <- replace(ETP, is.na(ETP),mean(ETP,na.rm=T))\n  rain <- as.numeric(MATTEMP$rainfall); rain <- replace(rain, is.na(rain),mean(rain,na.rm=T))\n  wind <- MATTEMP$windtot ; wind <- replace(wind, is.na(wind),999)\n  vapor_pressure <- rep(999,dim(MATTEMP)[1])\n  CO2 <- rep(405,dim(MATTEMP)[1])\n\n  MATOUT <- data.frame(Weather_name,ian,mo,jo,jul,tmin,tmax,srad,ETP,rain,wind,vapor_pressure,CO2)\n\n  write.csv2(MATOUT,file = paste('DATA/STICS_MAILING_INPUT/WEATHER_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Weather created'))\n}\n\nINPUTOBS <- function(IDCODE){\n  \n  MATUSMS <- read.csv2(paste('DATA/STICS_MAILING_INPUT/USMs_',IDCODE,'.csv',sep=''),header=T,sep=';')\n  USMS <- (MATUSMS$usm_nom)\n  require(stringr)\n  TREATCODE <- sapply(1:dim(MATUSMS)[1], function(i) str_sub(MATUSMS$usm_nom[i],start=5))\n  \n  MATOBSP <- read.csv2(file = 'DATA/ECOFI_DATAVERSE/ecofi_obsplant.csv',header = T,sep =\";\",stringsAsFactors = F)\n  head(MATOBSP)\n  \n  VARCYCLE <- str_sub(USMS,start=5)\n  MATOBSP <- MATOBSP[which(MATOBSP$varcyclecode %in% VARCYCLE),]\n  VAROBS <- levels(as.factor(MATOBSP$obsplantlib))\n  VAROBSINT <- c('ei','lai','mfa','mflv','mftu',\n                 'msa','msfm','mslv','mstu','mssucrtu','sucrt')\n  STICSVAR <- c('fapar','lai(n)','mafrais','mafeuil','pdsfruitfrais',\n                'masec(n)','mafeuiljaune','mafeuilverte','mafruit','sucre','sucre_percent')\n  \n  MATOBSTICS <- data.frame(matrix(rep(NA,6+length(STICSVAR)),nrow=1))\n  names(MATOBSTICS) <- c('usm_name','ian','mo','jo','jul','date',STICSVAR)\n    \n  for (i in 1:length(VARCYCLE)){\n    MATTEMP <- MATOBSP[which(MATOBSP$varcyclecode==VARCYCLE[i]),]\n    if(dim(MATTEMP)[1] > 0){\n      DATE <- MATTEMP$obsplantdate ; DATE <- as.Date(DATE,format='%d/%m/%Y')\n      OBSDATE <- sort(levels(as.factor(DATE)))\n      usm_name <- rep(MATTEMP$varcyclecode[1],length(OBSDATE))\n      ian <- str_sub(OBSDATE,end=4)\n      mo <- as.numeric(str_sub(OBSDATE,start=6,end=7))\n      jo <- as.numeric(str_sub(OBSDATE,start=9))\n      INIDATE <- sapply(1:length(OBSDATE), function(i) paste(ian[i],'-01-01',sep=''))\n      jul <- as.numeric(as.Date(OBSDATE,format='%Y-%m-%d')-as.Date(INIDATE,format='%Y-%m-%d'))+1\n      date <- format(as.Date(OBSDATE,format='%Y-%m-%d'),format='%d/%m/%Y')\n\n      MATOBSTEMP <- matrix(c(usm_name,ian,mo,jo,jul,date,rep(rep('',length(OBSDATE)),length(STICSVAR))),\n                             nrow=length(OBSDATE),byrow=F)\n      \n      for (j in 1:length(OBSDATE)){\n        VAL <-c() \n        for (k in 1:length(VAROBSINT)){\n          val <- as.numeric(MATTEMP$obsplantval[MATTEMP$obsplantdate==date[j]][MATTEMP$obsplantlib[MATTEMP$obsplantdate==date[j]]==VAROBSINT[k]])\n          if(length(val)==0){VAL <- c(VAL,'')}\n          if(length(val) >0){VAL <- c(VAL,val)}\n        }\n        MATOBSTEMP[j,7:(6+length(STICSVAR))] <- VAL\n      }\n      \n      MATOBSTEMP <- data.frame(MATOBSTEMP)\n      names(MATOBSTEMP) <- names(MATOBSTICS)\n      MATOBSTICS <- rbind(MATOBSTICS,MATOBSTEMP)  \n      \n    }\n    \n  }\n\n  MATOBSTICS <- MATOBSTICS[2:dim(MATOBSTICS)[1],]\n\n  write.csv2(MATOBSTICS,file = paste('DATA/STICS_MAILING_INPUT/OBS_',IDCODE,'.csv',sep=''),quote = F,row.names = F,\n             col.names = T,dec = '.',sep = ';')\n  print(paste('Obs created'))\n}\n    \n\n\n\nINPUTTRAITMOS <- function(TREATCODE,SETOUT='DATA/MOSICAS_INPUT/',IDCODE=''){\n  TREATCODE <- sort(as.vector(TREATCODE))\n  MATPC <- read.csv2(file = 'DATA/SAUV_ECOFY/ecofi_plotcycle.csv',header = T,sep =\";\")\n  MATVC <- read.csv2(file = 'DATA/SAUV_ECOFY/ecofi_varcycle.csv',header = T,sep =\";\")\n  MATP <- read.csv2(file = 'DATA/SAUV_ECOFY/ecofi_plot.csv',header = T,sep =\";\")\n  MATT <- read.csv2(file = 'DATA/SAUV_ECOFY/ecofi_trial.csv',header = T,sep =\";\")\n  MATWT <- read.csv2(file = 'DATA/SAUV_ECOFY/ecofi_wstrial.csv',header = T,sep =\";\")\n  head(MATVC)\n  \n  irricode <- sapply(1:length(TREATCODE), function(i) MATPC$irricode[MATPC$plotcyclecode == TREATCODE[i]])\n  inisoilvol <- sapply(1:length(TREATCODE), function(i) MATPC$inisoilvol[MATPC$plotcyclecode == TREATCODE[i]])\n  cycle <- sapply(1:length(TREATCODE), function(i) MATPC$cycle[MATPC$plotcyclecode == TREATCODE[i]])\n  varcode <- sapply(1:length(TREATCODE), function(i) MATVC$varcode[MATVC$plotcyclecode==TREATCODE[i]])\n  \n  plotcode <- as.vector(sapply(1:length(TREATCODE), function(i) MATPC$plotcode[MATPC$plotcyclecode == TREATCODE[i]]))\n  \n  \n  nbbgi <- sapply(1:length(TREATCODE), function(i) MATP$nbbgi[MATP$plotcode==plotcode[i]])\n  rowspace <- sapply(1:length(TREATCODE), function(i) MATP$rowspace[MATP$plotcode==plotcode[i]])\n  \n  trialcode <- as.vector(sapply(1:length(TREATCODE), function(i) MATP$trialcode[MATP$plotcode==plotcode[i]]))\n  \n  trialalt <- sapply(1:length(TREATCODE), function(i) MATT$trialalt[MATT$trialcode==trialcode[i]])\n  trialat <- sapply(1:length(TREATCODE), function(i) MATT$trialat[MATT$trialcode==trialcode[i]])\n  trialong <- sapply(1:length(TREATCODE), function(i) MATT$trialong[MATT$trialcode==trialcode[i]])\n  soilcode <- sapply(1:length(TREATCODE), function(i) MATT$soilcode[MATT$trialcode==trialcode[i]])\n  rootdepth <- sapply(1:length(TREATCODE), function(i) MATT$rootdepth[MATT$trialcode==trialcode[i]])\n  \n  wstacode <- sapply(1:length(TREATCODE), function(i) MATWT$wscode[MATWT$trialcode==trialcode[i]])\n  \n  begdate <- sapply(1:length(TREATCODE), function(i) MATVC$cyclestartingdate[MATVC$plotcyclecode==TREATCODE[i]])\n  enddate <- sapply(1:length(TREATCODE), function(i) MATVC$cyclendingdate[MATVC$plotcyclecode==TREATCODE[i]])\n  begdate <- format(as.Date(begdate), \"%d-%m-%Y\")\n  enddate <- format(as.Date(enddate), \"%d-%m-%Y\")\n  \n  \n  treatcode <- TREATCODE\n  MATOUT <- data.frame(nbbgi,treatcode,cycle,varcode,rowspace,begdate,enddate,trialat,trialong,\n                       trialalt,soilcode,inisoilvol,rootdepth,irricode,wstacode)  \n  write.table(MATOUT,file = paste(SETOUT,'/trait_',IDCODE,'.txt',sep=''),col.names=T,\n              row.names=F,sep='\\t',quote=F)\n}\n\n\nINPUTWSMOS <- function(TREATCODE,SETOUT='DATA/MOSICAS_INPUT/',IDCODE=''){\n  TREATCODE <- sort(as.vector(TREATCODE))\n  MATWD <- read.csv2(file = 'DATA/SAUV_ECOFY/ecofi_wdataday.csv',header = T,sep =\";\")\n  MATTRAIT <- read.table(paste(SETOUT,'/trait_',IDCODE,'.txt',sep=''),header=T)\n  head(MATWD)\n  Wscode <- levels(as.factor(MATTRAIT$wstacode))\n  for (i in 1:length(Wscode)){\n    MATTEMP <- MATWD[MATWD$wscode==Wscode[i],]\n    \n    date <- MATTEMP$weatherdate ; date <- format(as.Date(date), \"%d-%m-%Y\")\n    rr <- MATTEMP$rainfall ; rr <- replace(rr,is.na(rr),-999)\n    etp <- MATTEMP$eto ; etp <- replace(etp,is.na(etp),-999)\n    tx <- MATTEMP$tmax ; tx <- replace(tx,is.na(tx),-999)\n    tn <- MATTEMP$tmin ; tn <- replace(tn,is.na(tn),-999)\n    rg <- MATTEMP$grad ; rg <- replace(rg,is.na(rg),-999)\n    ux <- MATTEMP$rhmax ; ux <- replace(ux,is.na(ux),-999)\n    un <- MATTEMP$rhmin ; un <- replace(un,is.na(un),-999)\n    vt <- MATTEMP$windtot ; vt <- replace(vt,is.na(vt),-999)\n    tm <- MATTEMP$tmoy ; tm <- replace(tm,is.na(tm),-999)\n    MATOUT <- data.frame(date,rr,etp,tx,tn,rg,ux,un,vt,tm)\n    write.table(MATOUT,file = paste(SETOUT,'/',Wscode[i],'.txt',sep=''),col.names=T,\n                row.names=F,sep='\\t',quote=F)\n    \n  }\n}\n\n\n\nINPUTOBSMOS <- function(TREATCODE,SETOUT='DATA/MOSICAS_INPUT/',IDCODE=''){\n  \n  TREATCODE <- sort(as.vector(TREATCODE))\n  MATOBS <- read.csv(file = 'DATA/SAUV_ECOFY/ecofi_obsplant.csv',header = T,sep =\";\")\n  MATOBS <- MATOBS[which(MATOBS$varcyclecode %in% TREATCODE),]\n  \n  MATstagnb <- MATOBS[which(MATOBS$obsplantlib %in% 'nbtv'),c(6,8,5,7)]\n  MATstadnb <- MATOBS[which(MATOBS$obsplantlib %in% 'nbtm'),c(6,8,5,7)]\n  MATstafnb <- MATOBS[which(MATOBS$obsplantlib %in% 'nbtfl'),c(6,8,5,7)]\n  MATstafnb <- data.frame('nbtfl','CVA1-0-0-AAA-R579','2003-03-24',NA) ; names(MATstafnb) <- names(MATstagnb)\n  MATstahtvd <- MATOBS[which(MATOBS$obsplantlib %in% 'htm'),c(6,8,5,7)]\n  MATblatnb <- MATOBS[which(MATOBS$obsplantlib %in% 'nblts'),c(6,8,5,7)]\n  MATblagnb <- MATOBS[which(MATOBS$obsplantlib %in% 'nblvs'),c(6,8,5,7)]\n  MATblastvd <- MATOBS[which(MATOBS$obsplantlib %in% 'ltvdsurfs'),c(6,8,5,7)]\n  MATglai <- MATOBS[which(MATOBS$obsplantlib %in% 'lai'),c(6,8,5,7)]\n  MATei <- MATOBS[which(MATOBS$obsplantlib %in% 'ei'),c(6,8,5,7)]\n  MATstamsu <- MATOBS[which(MATOBS$obsplantlib %in% 'mssucrtu'),c(6,8,5,7)]\n  MATstamfm <- MATOBS[which(MATOBS$obsplantlib %in% 'mftu'),c(6,8,5,7)]\n  MATstamdm <- MATOBS[which(MATOBS$obsplantlib %in% 'mstu'),c(6,8,5,7)]\n  MATstamwc <- MATOBS[which(MATOBS$obsplantlib %in% 'humtig'),c(6,8,5,7)]\n  MATstamsuc <- MATOBS[which(MATOBS$obsplantlib %in% 'brixjt'),c(6,8,5,7)]\n  MATstamfbc <- MATOBS[which(MATOBS$obsplantlib %in% 'fibrt'),c(6,8,5,7)]\n  MATstampur <- MATOBS[which(MATOBS$obsplantlib %in% 'brixjt'),c(6,8,5,7)] ######### problème pas bon\n  MATblagdm <- MATOBS[which(MATOBS$obsplantlib %in% 'mslv'),c(6,8,5,7)]\n  MATbladm <- MATOBS[which(MATOBS$obsplantlib %in% 'mslt'),c(6,8,5,7)]\n  MATbladm <- data.frame('mslt','CVA1-0-0-AAA-R579','2003-03-24',NA) ; names(MATbladm) <- names(MATstagnb)\n  MATagrfm <- MATOBS[which(MATOBS$obsplantlib %in% 'mfa'),c(6,8,5,7)]\n  MATagrdm <- MATOBS[which(MATOBS$obsplantlib %in% 'msa'),c(6,8,5,7)]\n  MATagrwc <- MATOBS[which(MATOBS$obsplantlib %in% 'humaer'),c(6,8,5,7)]\n  MATsendm <- MATOBS[which(MATOBS$obsplantlib %in% 'msasen'),c(6,8,5,7)]\n  \n  NAMESLIST <- c('stagnb','stadnb','stafnb','stahtvd','blatnb','blagnb','blastvd','glai','ei','stamsu','stamfm','stamdm',\n                 'stamwc','stamsuc','stamfbc','stambjc','stampur','blagdm','bladm','agrfm','agrdm','agrwc','sendm')\n  MATLIST <- list(MATstagnb,MATstadnb,MATstafnb,MATstahtvd,MATblatnb,MATblagnb,MATblastvd,MATglai,MATei,\n                  MATstamsu,MATstamfm,MATstamdm,MATstamwc,MATstamsuc,MATstamfbc,MATstampur,MATstampur,MATblagdm,\n                  MATbladm,MATagrfm,MATagrdm,MATagrwc,MATsendm)\n  \n  MATOBSPLANT <- merge(MATLIST[[1]][,2:4],MATLIST[[2]][,2:4],by=c('varcyclecode','obsplantdate'),all=T)\n  names(MATOBSPLANT)[3:4] <- c(NAMESLIST[1],NAMESLIST[2])\n  for (i in 3:23){\n    MATOBSPLANT <- merge(MATOBSPLANT,MATLIST[[i]][,2:4],by=c('varcyclecode','obsplantdate'),all=T)\n    names(MATOBSPLANT)[i+2] <- c(NAMESLIST[i])\n  }\n  #head(MATOBSPLANT)\n  \n  MATOBSPLANT <- replace(MATOBSPLANT,is.na(MATOBSPLANT), '-999')\n  calage <- rep(1,dim(MATOBSPLANT)[1])\n  MATOBSOUT <- data.frame(MATOBSPLANT[,1:2],calage,MATOBSPLANT[,3:25])\n  OBSDATE <- MATOBSOUT$obsplantdate\n  OBSDATE <- format(as.Date(OBSDATE), \"%d-%m-%Y\")\n  MATOBSOUT$obsplantdate <- OBSDATE\n  \n  names(MATOBSOUT)[1:2] <- c('treatcode','obsdate')\n  \n  write.table(MATOBSOUT,file = paste(SETOUT,'/obsplant_',IDCODE,'.txt',sep=''),col.names=T,\n              row.names=F,sep='\\t',quote=F)\n  \n}\n\n",
    "created" : 1558447698968.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "77|29|136|0|\n138|30|257|0|\n259|29|338|0|\n340|32|422|0|\n424|34|501|0|\n587|29|640|0|\n642|33|678|0|\n680|29|740|0|\n745|76|786|0|\n789|73|813|0|\n817|74|874|0|\n",
    "hash" : "592741196",
    "id" : "869DE437",
    "lastKnownWriteTime" : 1565962295,
    "last_content_update" : 1565962295505,
    "path" : "~/Recherche/Cirad/SD_Ecofy_base_donnees/R_base_donne/SCRIPT/R_function_stics_input.R",
    "project_path" : "SCRIPT/R_function_stics_input.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}